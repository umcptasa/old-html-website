{"version":3,"sources":["../../src/utils/get-ssl-cert.js"],"names":["getDevelopmentCertificate","require","default","report","fs","path","absoluteOrDirectory","directory","filePath","isAbsolute","join","module","exports","name","certFile","keyFile","panic","keyPath","certPath","key","readFileSync","cert","info","installCertutil","err"],"mappings":";;AAAA,MAAMA,yBAAyB,GAAGC,OAAO,CAAE,aAAF,CAAP,CAAuBC,OAAzD;;AACA,MAAMC,MAAM,GAAGF,OAAO,CAAE,yBAAF,CAAtB;;AACA,MAAMG,EAAE,GAAGH,OAAO,CAAE,IAAF,CAAlB;;AACA,MAAMI,IAAI,GAAGJ,OAAO,CAAE,MAAF,CAApB;;AAEA,MAAMK,mBAAmB,GAAG,CAACC,SAAD,EAAYC,QAAZ,KAAyB;AACnD;AACA,MAAIH,IAAI,CAACI,UAAL,CAAgBD,QAAhB,CAAJ,EAA+B;AAC7B,WAAOA,QAAP;AACD;;AACD,SAAOH,IAAI,CAACK,IAAL,CAAUH,SAAV,EAAqBC,QAArB,CAAP;AACD,CAND;;AAQAG,MAAM,CAACC,OAAP,GAAiB,OAAO;AAAEC,EAAAA,IAAF;AAAQC,EAAAA,QAAR;AAAkBC,EAAAA,OAAlB;AAA2BR,EAAAA;AAA3B,CAAP,KAAkD;AACjE;AACA;AACA,MAAIO,QAAQ,GAAG,CAACC,OAAJ,GAAcA,OAA1B,EAAmC;AACjCZ,IAAAA,MAAM,CAACa,KAAP,CACG,2EADH;AAGD;;AAED,MAAIF,QAAQ,IAAIC,OAAhB,EAAyB;AACvB,UAAME,OAAO,GAAGX,mBAAmB,CAACC,SAAD,EAAYQ,OAAZ,CAAnC;AACA,UAAMG,QAAQ,GAAGZ,mBAAmB,CAACC,SAAD,EAAYO,QAAZ,CAApC;AAEA,WAAO,MAAM;AACXG,MAAAA,OADW;AAEXC,MAAAA,QAFW;AAGXC,MAAAA,GAAG,EAAEf,EAAE,CAACgB,YAAH,CAAgBH,OAAhB,CAHM;AAIXI,MAAAA,IAAI,EAAEjB,EAAE,CAACgB,YAAH,CAAgBF,QAAhB;AAJK,KAAb;AAMD;;AAEDf,EAAAA,MAAM,CAACmB,IAAP,CAAa,2DAAb;;AACA,MAAI;AACF,WAAO,MAAMtB,yBAAyB,CAACa,IAAD,EAAO;AAC3CU,MAAAA,eAAe,EAAE;AAD0B,KAAP,CAAtC;AAGD,GAJD,CAIE,OAAOC,GAAP,EAAY;AACZrB,IAAAA,MAAM,CAACa,KAAP,CAAc,0CAAd,EAAyDQ,GAAzD;AACD;;AAED,SAAO,KAAP;AACD,CA/BD","sourcesContent":["const getDevelopmentCertificate = require(`devcert-san`).default\nconst report = require(`gatsby-cli/lib/reporter`)\nconst fs = require(`fs`)\nconst path = require(`path`)\n\nconst absoluteOrDirectory = (directory, filePath) => {\n  // Support absolute paths\n  if (path.isAbsolute(filePath)) {\n    return filePath\n  }\n  return path.join(directory, filePath)\n}\n\nmodule.exports = async ({ name, certFile, keyFile, directory }) => {\n  // check that cert file and key file are both true or both false, if they are both\n  // false, it defaults to the automatic ssl\n  if (certFile ? !keyFile : keyFile) {\n    report.panic(\n      `for custom ssl --https, --cert-file, and --key-file must be used together`\n    )\n  }\n\n  if (certFile && keyFile) {\n    const keyPath = absoluteOrDirectory(directory, keyFile)\n    const certPath = absoluteOrDirectory(directory, certFile)\n\n    return await {\n      keyPath,\n      certPath,\n      key: fs.readFileSync(keyPath),\n      cert: fs.readFileSync(certPath),\n    }\n  }\n\n  report.info(`setting up automatic SSL certificate (may require sudo)\\n`)\n  try {\n    return await getDevelopmentCertificate(name, {\n      installCertutil: true,\n    })\n  } catch (err) {\n    report.panic(`\\nFailed to generate dev SSL certificate`, err)\n  }\n\n  return false\n}\n"],"file":"get-ssl-cert.js"}